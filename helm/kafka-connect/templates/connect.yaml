{{- range $k, $v := .Values.connectCluster.clusters }}
apiVersion: platform.confluent.io/v1beta1
kind: Connect
metadata:
  name: {{ $v.name }}
  namespace: {{ .Values.namespace }}
spec:
  replicas: {{ $v.replicas }}
  image:
    application: {{ .Values.connectCluster.applicationImage }}
    init: {{ .Values.connectCluster.initImage }}
  {{ $k.build }}:
    {{ $v.build | toYaml }}
  tls:
    autoGeneratedCerts: true
  mountedSecrets:
    - secretRef: {{ kafka-client-config-secure }}
  dependencies:
    kafka:
      bootstrapEndpoint: "{{ .Values.confluentCloud.url }}:{{ .Values.confluentCloud.port }}"
      authentication:
        type: plain
        jaasConfig:
          secretRef: {{ cloud-plain }}
      tls:
        enabled: true
        ignoreTrustStoreConfig: true
    schemaRegistry:
      url: {{ SCHEMA REGISTRY ENDPOINT }}
      authentication:
        type: basic
        basic:
          secretRef: {{ cloud-sr-access }}
---
{{- end }}